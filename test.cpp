//-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------//
// Alexey Potehin <gnuplanet@gmail.com>, http://www.gnuplanet.ru/doc/cv
//-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------//
#include <stdio.h>
#include <stdint.h>
#include "crc32.h"
//-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------//
int test_crc32(const char *str, size_t size, uint32_t value_good)
{
	crc32_t crc32;
	crc32.update(str, size);
	uint32_t value = crc32.get();


	if (value != value_good)
	{
		printf("ERROR: crc32 invalid (0x%08x != 0x%08x)\n", value, value_good);
		return -1;
	}


	return 0;
}
//-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------//
int test()
{
	char str1[] = "мама";
	char str2[] = "мама мыла";
	char str3[] = "мама мыла раму";
	char str4[] = "мама мыла раму, а шура шары";


	if (test_crc32(str1, sizeof(str1) - 1, 0x265A50E4) != 0) return -1;
	if (test_crc32(str2, sizeof(str2) - 1, 0x5BCE26C4) != 0) return -1;
	if (test_crc32(str3, sizeof(str3) - 1, 0x027BA318) != 0) return -1;
	if (test_crc32(str4, sizeof(str4) - 1, 0x7EF926B7) != 0) return -1;


	return 0;
}
//-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------//
int main()
{
	if (test() != 0)
	{
		return 1;
	}
	printf("ok, test passed\n");


	return 0;
}
//-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------//
